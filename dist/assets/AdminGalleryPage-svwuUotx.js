import{j as e}from"./ui-8WPU0r-m.js";import{g as s,s as i,f as t}from"./index-KWbUu1bC.js";import{a as l}from"./vendor-DxT-Uw0Z.js";import{A as a}from"./AdminLayout-BtE7-Up5.js";import{P as r}from"./A11yControls-BZlVbuaH.js";import{E as n,a as c,S as o,T as d}from"./trash-2-E7PGo2b4.js";import"./supabase-HSrNVv04.js";function m(){const[m,x]=l.useState([]),[u,h]=l.useState(!0),[g,f]=l.useState(!1),[y,b]=l.useState(!1),[p,j]=l.useState(null),[v,N]=l.useState({title:"",image:"",display_order:0,is_active:!0}),[w,k]=l.useState(null),[S,_]=l.useState(null),[z,C]=l.useState(null),[G,D]=l.useState(!1),[E,F]=l.useState([]),[$,A]=l.useState(0),[U,Y]=l.useState(!1),B=async()=>{h(!0);try{const e=await s.getAllForAdmin();x(e||[])}catch(e){e instanceof Error?e.message:String(e)}finally{h(!1)}};l.useEffect((()=>{B()}),[]);return e.jsxs(a,{children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Galeri"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>{F([]),A(0),Y(!0)},className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:[e.jsx(r,{className:"-ml-1 mr-2 h-5 w-5"})," Toplu Resim Yükle"]}),e.jsxs("button",{onClick:()=>{j(null),N({title:"",image:"",display_order:0,is_active:!0}),k(null),b(!0)},className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(r,{className:"-ml-1 mr-2 h-5 w-5"})," Yeni Galeri Öğesi Ekle"]})]})]}),S&&e.jsx("div",{className:"rounded-md bg-red-50 p-4 mb-6",children:e.jsx("div",{className:"flex",children:e.jsx("div",{className:"ml-3",children:e.jsx("h3",{className:"text-sm font-medium text-red-800",children:S})})})}),z&&e.jsx("div",{className:"rounded-md bg-green-50 p-4 mb-6",children:e.jsx("div",{className:"flex",children:e.jsx("div",{className:"ml-3",children:e.jsx("h3",{className:"text-sm font-medium text-green-800",children:z})})})}),u?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:e.jsx("ul",{className:"divide-y divide-gray-200",children:0===m.length?e.jsx("li",{className:"px-6 py-4 text-center text-gray-500",children:"Henüz hiç galeri öğesi eklenmemiş"}):m.map((s=>e.jsx("li",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-16 w-16",children:e.jsx("img",{className:"h-16 w-16 rounded object-cover",src:s.image,alt:s.title,onError:e=>{e.target.src="https://via.placeholder.com/150"}})}),e.jsxs("div",{className:"ml-4",children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[s.title,!1===s.is_active&&e.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:"Pasif"})]}),e.jsx("div",{className:"mt-1",children:e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:["Sıra: ",s.display_order]})})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>(async e=>{try{const{error:s}=await i.from("gallery").update({is_active:!e.is_active}).eq("id",e.id);if(s)throw s;B(),C(`Galeri öğesi ${e.is_active?"gizli":"görünür"} duruma getirildi`)}catch(s){const e=s instanceof Error?s.message:String(s);_(`Görünürlük değiştirilirken hata oluştu: ${e}`)}})(s),className:"p-2 rounded-full "+(!1!==s.is_active?"text-green-500 hover:bg-green-50":"text-gray-500 hover:bg-gray-50"),title:!1!==s.is_active?"Gizle":"Göster",children:!1!==s.is_active?e.jsx(n,{className:"h-5 w-5"}):e.jsx(c,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>(e=>{j(e),N({title:e.title,image:e.image,display_order:e.display_order,is_active:void 0===e.is_active||e.is_active}),k(null),b(!0)})(s),className:"p-2 text-indigo-600 hover:bg-indigo-50 rounded-full",title:"Düzenle",children:e.jsx(o,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>(async e=>{if(window.confirm("Bu galeri öğesini silmek istediğinizden emin misiniz?"))try{const l=m.find((s=>s.id===e));if(l&&l.image)try{await t.deleteFile(l.image)}catch(s){}const{error:a}=await i.from("gallery").delete().eq("id",e);if(a)throw a;C("Galeri öğesi başarıyla silindi"),B()}catch(l){const e=l instanceof Error?l.message:String(l);_(`Silme işlemi sırasında hata oluştu: ${e}`)}})(s.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-full",title:"Sil",children:e.jsx(d,{className:"h-5 w-5"})})]})]})},s.id)))})}),y&&e.jsx("div",{className:"fixed inset-0 z-10 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:()=>b(!1)}),e.jsxs("div",{className:"relative bg-white rounded-lg max-w-3xl w-full p-6",children:[e.jsx("div",{className:"mb-4 border-b pb-4",children:e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:p?"Galeri Öğesini Düzenle":"Yeni Galeri Öğesi Ekle"})}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),_(null),C(null),f(!0);try{if(!v.title)return _("Lütfen başlık alanını doldurun"),void f(!1);let e=v.image;if(w)try{e=(await t.uploadFile(w,"gallery")).url}catch(s){const e=s instanceof Error?s.message:String(s);return _(`Dosya yükleme hatası: ${e}`),void f(!1)}else if(!p&&!v.image)return _("Lütfen bir görsel dosyası seçin"),void f(!1);if(p){const{error:s}=await i.from("gallery").update({title:v.title,image:e,is_active:v.is_active}).eq("id",p.id);if(s)throw s;C("Galeri öğesi başarıyla güncellendi")}else{const s=Math.floor(Date.now()/1e3),{error:t}=await i.from("gallery").insert([{title:v.title,image:e,display_order:s,is_active:v.is_active}]);if(t)throw t;C("Galeri öğesi başarıyla eklendi")}B(),b(!1)}catch(l){const e=l instanceof Error?l.message:String(l);_(`İşlem sırasında hata oluştu: ${e}`)}finally{f(!1)}},children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700",children:"Başlık"}),e.jsx("input",{type:"text",name:"title",id:"title",value:v.title,onChange:e=>{const{name:s,value:i}=e.target;N({...v,[s]:i})},className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"imageUpload",className:"block text-sm font-medium text-gray-700",children:"Görsel"}),e.jsxs("div",{className:"mt-1 flex items-center",children:[e.jsx("input",{type:"file",id:"imageUpload",onChange:e=>{e.target.files&&e.target.files.length>0?k(e.target.files[0]):k(null)},accept:"image/*",className:"sr-only"}),e.jsx("label",{htmlFor:"imageUpload",className:"relative cursor-pointer bg-white py-2 px-3 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none",children:e.jsx("span",{children:"Dosya Seç"})}),e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:w?w.name:(null==p?void 0:p.image)?"Mevcut görsel kullanılacak":"Dosya seçilmedi"})]}),(v.image||w)&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Görsel Önizleme:"}),e.jsx("div",{className:"h-40 w-40 relative border rounded overflow-hidden",children:e.jsx("img",{src:w?URL.createObjectURL(w):v.image,alt:"Önizleme",className:"h-full w-full object-cover",onError:e=>{e.target.src="https://via.placeholder.com/150"}})})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"is_active",id:"is_active",checked:v.is_active,onChange:e=>{const{name:s,checked:i}=e.target;N({...v,[s]:i})},className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"is_active",className:"ml-2 block text-sm text-gray-900",children:"Aktif (Görünür)"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>b(!1),className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"İptal"}),e.jsx("button",{type:"submit",disabled:g,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:g?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Yükleniyor..."]}):"Kaydet"})]})]})]})]})})]}),U&&e.jsx("div",{className:"fixed inset-0 z-10 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:()=>!G&&Y(!1)}),e.jsxs("div",{className:"relative bg-white rounded-lg max-w-3xl w-full p-6",children:[e.jsx("div",{className:"mb-4 border-b pb-4",children:e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Toplu Galeri Öğesi Yükleme"})}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),_(null),C(null),D(!0),A(0);try{if(0===E.length)return _("Lütfen en az bir görsel dosyası seçin"),void D(!1);if(E.length>100)return _("Bir seferde en fazla 100 dosya yükleyebilirsiniz"),void D(!1);let e=0,s=0;const l=Math.floor(Date.now()/1e3),a=5;for(let r=0;r<E.length;r+=a){const n=E.slice(r,r+a);(await Promise.allSettled(n.map((async(e,s)=>{const a=r+s;try{let s=e.name.split(".")[0];s=s.replace(/[^\wıİğĞüÜşŞöÖçÇ\s]/g,"").replace(/\s+/g," ").trim(),(!s||s.length<3)&&(s=`Galeri Öğesi ${l+a}`);const r=await t.uploadFile(e,"gallery"),n=l+a,{error:c}=await i.from("gallery").insert([{title:s,image:r.url,display_order:n,is_active:!0}]);if(c)throw c;return{success:!0}}catch(n){return{success:!1,fileName:e.name,error:n}}})))).forEach((i=>{"fulfilled"===i.status&&i.value.success?e++:s++})),A(Math.floor((r+n.length)/E.length*100)),r+a<E.length&&await new Promise((e=>setTimeout(e,500)))}0===e?_("Hiçbir dosya yüklenemedi, lütfen tekrar deneyin."):C(s>0?`${e} galeri öğesi başarıyla yüklendi. ${s} dosya yüklenemedi.`:`${e} galeri öğesi başarıyla yüklendi.`),B(),Y(!1)}catch(s){const e=s instanceof Error?s.message:String(s);_(`Toplu yükleme sırasında hata oluştu: ${e}`)}finally{D(!1)}},children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bulkImageUpload",className:"block text-sm font-medium text-gray-700",children:"Görseller (Birden fazla seçebilirsiniz)"}),e.jsxs("div",{className:"mt-1 flex items-center",children:[e.jsx("input",{type:"file",id:"bulkImageUpload",onChange:e=>{if(e.target.files&&e.target.files.length>0){const s=Array.from(e.target.files).filter((e=>e.type.startsWith("image/")));F(s)}},accept:"image/*",multiple:!0,className:"sr-only",disabled:G}),e.jsx("label",{htmlFor:"bulkImageUpload",className:"relative cursor-pointer bg-white py-2 px-3 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none "+(G?"opacity-50 cursor-not-allowed":""),children:e.jsx("span",{children:"Dosyaları Seç"})}),e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:E.length>0?`${E.length} dosya seçildi`:"Dosya seçilmedi"})]})]}),E.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Seçilen Dosyalar:"}),e.jsx("div",{className:"max-h-40 overflow-y-auto border rounded-md p-2",children:e.jsx("ul",{className:"divide-y divide-gray-200",children:E.map(((s,i)=>e.jsxs("li",{className:"py-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-black truncate max-w-xs",children:s.name}),e.jsxs("span",{className:"text-xs text-gray-500",children:[(s.size/1024).toFixed(2)," KB"]})]},i)))})})]}),G&&e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"relative pt-1",children:[e.jsxs("div",{className:"flex mb-2 items-center justify-between",children:[e.jsx("div",{children:e.jsx("span",{className:"text-xs font-semibold inline-block text-blue-600",children:"Yükleniyor"})}),e.jsx("div",{className:"text-right",children:e.jsxs("span",{className:"text-xs font-semibold inline-block text-blue-600",children:["%",$]})})]}),e.jsx("div",{className:"overflow-hidden h-2 mb-4 text-xs flex rounded bg-blue-200",children:e.jsx("div",{style:{width:`${$}%`},className:"shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-blue-500 transition-all duration-300"})})]})})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>Y(!1),className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",disabled:G,children:"İptal"}),e.jsx("button",{type:"submit",disabled:G||0===E.length,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:G?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Yükleniyor..."]}):"Seçilen Dosyaları Yükle"})]})]})]})]})})]})}export{m as default};
