import{j as e}from"./ui-8WPU0r-m.js";import{a as s,d as a,u as t,L as i}from"./vendor-DxT-Uw0Z.js";import{S as r,X as l,M as n,P as d,h as c,i as o,p as m,l as x,f as u}from"./index-KWbUu1bC.js";import{H as h,A as g,I as f,N as b,U as y,L as p,P as j,a as v}from"./A11yControls-BZlVbuaH.js";import{A as N}from"./arrow-left-DrOe5Phb.js";import{a as w,E as k,S as C,T as z}from"./trash-2-E7PGo2b4.js";import{f as S,t as _}from"./tr-CIIfQ1qk.js";import"./supabase-HSrNVv04.js";function B(){const[B,A]=s.useState([]),[E,M]=s.useState(!0),[D,H]=s.useState(!1),[K,P]=s.useState(!1),[Y,q]=s.useState(null),[F,G]=s.useState({title:"",source:"",date:S(new Date,"yyyy-MM-dd"),image:"",summary:"",link:"",is_active:!0}),[L,$]=s.useState(null),[I,T]=s.useState(null),[V,J]=s.useState(null),[U,R]=s.useState(!1),[W,O]=s.useState(null),Q=a(),X=t();s.useEffect((()=>{!async function(){const e=await c();(null==e?void 0:e.email)&&O(e.email)}()}),[]),s.useEffect((()=>{async function e(){await o()||Q("/admin/login")}e();const s=setInterval((()=>{e()}),3e5);return()=>{clearInterval(s)}}),[Q]);const Z=async()=>{const{success:e}=await x();e&&Q("/admin/login")},ee=[{name:"Kontrol Paneli",href:"/admin",icon:h},{name:"Faaliyetler",href:"/admin/faaliyetler",icon:g},{name:"Galeri",href:"/admin/galeri",icon:f},{name:"Basında Biz",href:"/admin/basin",icon:b}],se=e=>X.pathname===e,ae=async()=>{M(!0);try{const e=await m.getAllForAdmin();A(e||[])}catch(e){e instanceof Error?e.message:String(e)}finally{M(!1)}};s.useEffect((()=>{ae()}),[]);const te=e=>{const{name:s,value:a}=e.target;G({...F,[s]:a})},ie=e=>{try{return S(new Date(e),"d MMMM yyyy",{locale:_})}catch(s){return e}};return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsx(r,{}),e.jsx("div",{className:"fixed inset-0 z-40 bg-black bg-opacity-30 transition-opacity duration-300 lg:hidden "+(U?"opacity-100":"opacity-0 pointer-events-none"),onClick:()=>R(!1)}),e.jsx("div",{className:"fixed inset-y-0 left-0 w-72 z-50 bg-white shadow-xl transform transition-transform duration-300 ease-in-out lg:hidden "+(U?"translate-x-0":"-translate-x-full"),children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"h-16 flex items-center justify-between px-4 border-b",children:[e.jsx("div",{className:"text-xl font-bold text-indigo-600",children:"BJK Admin"}),e.jsx("button",{className:"p-1 rounded-full hover:bg-gray-100",onClick:()=>R(!1),children:e.jsx(l,{className:"h-6 w-6 text-gray-500"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx("nav",{className:"p-4 space-y-1",children:ee.map((s=>e.jsxs(i,{to:s.href,className:"flex items-center px-3 py-3 text-sm font-medium rounded-lg transition-colors "+(se(s.href)?"bg-indigo-50 text-indigo-700":"text-gray-700 hover:bg-gray-100 hover:text-gray-900"),onClick:()=>R(!1),children:[e.jsx(s.icon,{className:"mr-3 h-5 w-5 "+(se(s.href)?"text-indigo-500":"text-gray-400 group-hover:text-gray-500")}),s.name]},s.name)))})}),e.jsx("div",{className:"p-4 border-t",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 bg-indigo-100 rounded-full p-2",children:e.jsx(y,{className:"h-6 w-6 text-indigo-600"})}),e.jsxs("div",{className:"ml-3 min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:W||"Admin Kullanıcı"}),e.jsxs("button",{onClick:Z,className:"text-xs font-medium text-gray-500 hover:text-gray-700 flex items-center mt-1",children:[e.jsx(p,{className:"mr-1 h-3.5 w-3.5"})," Çıkış Yap"]})]})]})})]})}),e.jsxs("div",{className:"hidden lg:flex lg:flex-col lg:w-72 lg:fixed lg:inset-y-0 lg:border-r lg:border-gray-200 lg:bg-white",children:[e.jsx("div",{className:"h-16 flex items-center justify-center border-b border-gray-200",children:e.jsx("div",{className:"text-xl font-bold text-indigo-600",children:"BJK Admin"})}),e.jsx("div",{className:"flex-1 flex flex-col overflow-y-auto",children:e.jsx("nav",{className:"flex-1 p-4 space-y-1",children:ee.map((s=>e.jsxs(i,{to:s.href,className:"flex items-center px-3 py-3 text-sm font-medium rounded-lg transition-colors "+(se(s.href)?"bg-indigo-50 text-indigo-700":"text-gray-700 hover:bg-gray-100 hover:text-gray-900"),children:[e.jsx(s.icon,{className:"mr-3 h-5 w-5 "+(se(s.href)?"text-indigo-500":"text-gray-400 group-hover:text-gray-500")}),s.name]},s.name)))})}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 bg-indigo-100 rounded-full p-2",children:e.jsx(y,{className:"h-6 w-6 text-indigo-600"})}),e.jsxs("div",{className:"ml-3 min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:W||"Admin Kullanıcı"}),e.jsxs("button",{onClick:Z,className:"text-xs font-medium text-gray-500 hover:text-gray-700 flex items-center mt-1",children:[e.jsx(p,{className:"mr-1 h-3.5 w-3.5"})," Çıkış Yap"]})]})]})})]}),e.jsxs("div",{className:"flex-1 flex flex-col lg:pl-72",children:[e.jsxs("header",{className:"sticky top-0 z-10 flex h-16 bg-white shadow-sm",children:[e.jsx("button",{type:"button",className:"lg:hidden px-4 text-gray-500 focus:outline-none",onClick:()=>R(!0),children:e.jsx(n,{className:"h-6 w-6"})}),e.jsxs("div",{className:"flex-1 flex items-center justify-between px-4",children:[e.jsx("h1",{className:"text-lg font-medium text-gray-900",children:"Admin Paneli"}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsx("div",{className:"relative",children:e.jsxs("button",{className:"p-1 text-gray-400 rounded-full hover:text-gray-500 hover:bg-gray-100",children:[e.jsx("span",{className:"sr-only",children:"Bildirimler"}),e.jsxs("div",{className:"h-6 w-6 flex items-center justify-center",children:[e.jsx("div",{className:"h-2 w-2 absolute top-1 right-1 bg-red-500 rounded-full"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})})]})]})})})]})]}),e.jsx("main",{className:"flex-1 overflow-auto bg-gray-50 py-6",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx(d,{children:e.jsxs("div",{className:"container mx-auto py-8 px-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(i,{to:"/admin",className:"text-black hover:text-gray-900",children:e.jsx(N,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-2xl font-bold",children:"Basın Haberleri Yönetimi"})]}),e.jsxs("button",{onClick:()=>{q(null),G({title:"",source:"",date:S(new Date,"yyyy-MM-dd"),image:"",summary:"",link:"",is_active:!0}),$(null),P(!0)},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2",children:[e.jsx(j,{size:18})," Yeni Haber Ekle"]})]}),I&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4 relative",children:I}),V&&e.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4 relative",children:V}),E?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-gray-900"})}):0===B.length?e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 text-yellow-800 px-4 py-8 rounded text-center",children:"Henüz eklenmiş basın haberi bulunmamaktadır."}):e.jsx("div",{className:"bg-white shadow-md rounded-lg overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Başlık"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Kaynak"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tarih"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Durum"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"İşlemler"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:B.map((s=>e.jsxs("tr",{className:s.is_active?"":"bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-10 w-10 flex-shrink-0",children:e.jsx("img",{className:"h-10 w-10 rounded-md object-cover",src:s.image,alt:s.title})}),e.jsx("div",{className:"ml-4",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.title})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:s.source})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:ie(s.date)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full "+(s.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:s.is_active?"Aktif":"Pasif"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>(async e=>{try{await m.toggleVisibility(e.id,!e.is_active),J(`Basın haberi ${e.is_active?"gizli":"görünür"} duruma getirildi.`),A(B.map((s=>s.id===e.id?{...s,is_active:!s.is_active}:s)))}catch(s){const e=s instanceof Error?s.message:String(s);T(`Görünürlük değiştirme işlemi sırasında bir hata oluştu: ${e}`)}})(s),className:"text-indigo-600 hover:text-indigo-900 p-1 rounded hover:bg-indigo-50",title:s.is_active?"Gizle":"Göster",children:s.is_active?e.jsx(w,{size:16}):e.jsx(k,{size:16})}),e.jsx("button",{onClick:()=>(e=>{q(e),G({title:e.title,source:e.source,date:e.date.substring(0,10),image:e.image,summary:e.summary,link:e.link||"",is_active:e.is_active}),P(!0)})(s),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50",title:"Düzenle",children:e.jsx(C,{size:16})}),e.jsx("button",{onClick:()=>(async e=>{if(window.confirm("Bu basın haberini silmek istediğinizden emin misiniz?"))try{await m.delete(e),J("Basın haberi başarıyla silindi."),A(B.filter((s=>s.id!==e)))}catch(s){const e=s instanceof Error?s.message:String(s);T(`Silme işlemi sırasında bir hata oluştu: ${e}`)}})(s.id),className:"text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-50",title:"Sil",children:e.jsx(z,{size:16})})]})})]},s.id)))})]})}),K&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:Y?"Basın Haberi Düzenle":"Yeni Basın Haberi Ekle"}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),T(null),J(null);try{H(!0);let e=F.image;if(L){const s=await u.upload({file:L,bucket:"press",folderPath:"images"});if(!s)throw new Error("Dosya yükleme hatası");e=s.publicUrl}const s={title:F.title,source:F.source,date:F.date,image:e,summary:F.summary,link:F.link||void 0,is_active:F.is_active};Y?(await m.update(Y.id,s),J("Basın haberi başarıyla güncellendi.")):(await m.create(s),J("Yeni basın haberi başarıyla eklendi.")),ae(),P(!1)}catch(s){const e=s instanceof Error?s.message:String(s);T(`İşlem sırasında bir hata oluştu: ${e}`)}finally{H(!1)}},children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Başlık*"}),e.jsx("input",{type:"text",name:"title",required:!0,value:F.title,onChange:te,className:"w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Kaynak*"}),e.jsx("input",{type:"text",name:"source",required:!0,value:F.source,onChange:te,className:"w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tarih*"}),e.jsx("input",{type:"date",name:"date",required:!0,value:F.date,onChange:te,className:"w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Özet*"}),e.jsx("textarea",{name:"summary",required:!0,rows:3,value:F.summary,onChange:te,className:"w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Haber Bağlantısı"}),e.jsx("input",{type:"url",name:"link",value:F.link,onChange:te,placeholder:"https://...",className:"w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Resim ",!Y&&"(*)"]}),F.image&&e.jsx("div",{className:"mb-2",children:e.jsx("img",{src:F.image,alt:"Preview",className:"h-24 w-24 object-cover rounded-md"})}),e.jsx("input",{type:"file",accept:"image/*",onChange:e=>{if(e.target.files&&e.target.files.length>0){const s=e.target.files[0];if(s.size>5242880)return void T("Dosya boyutu 5MB'den büyük olamaz");$(s)}},className:"w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!Y&&!F.image})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"is_active",name:"is_active",checked:F.is_active,onChange:e=>{const{name:s,checked:a}=e.target;G({...F,[s]:a})},className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"is_active",className:"ml-2 block text-sm text-gray-900",children:"Aktif (görünür)"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>P(!1),className:"bg-gray-100 px-4 py-2 rounded-md text-gray-700 hover:bg-gray-200",disabled:D,children:"İptal"}),e.jsx("button",{type:"submit",className:"bg-blue-600 px-4 py-2 rounded-md text-white hover:bg-blue-700 flex items-center",disabled:D,children:D?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mr-2 h-4 w-4 rounded-full border-2 border-white border-t-transparent animate-spin"}),"İşleniyor..."]}):e.jsx(e.Fragment,{children:Y?"Güncelle":"Ekle"})})]})]})]})})})]})},X.pathname)})})]}),e.jsx(v,{})]})}export{B as default};
