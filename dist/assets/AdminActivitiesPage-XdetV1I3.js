import{j as e}from"./ui-8WPU0r-m.js";import{a as t}from"./vendor-DxT-Uw0Z.js";import{e as s,s as a,f as i}from"./index-KWbUu1bC.js";import{A as r}from"./AdminLayout-BtE7-Up5.js";import{P as l}from"./A11yControls-BZlVbuaH.js";import{E as n,a as d,S as c,T as o}from"./trash-2-E7PGo2b4.js";import"./supabase-HSrNVv04.js";function m(){const[m,u]=t.useState([]),[x,h]=t.useState(!0),[f,g]=t.useState(!1),[b,y]=t.useState(!1),[p,v]=t.useState(null),[j,w]=t.useState(null),[N,k]=t.useState({title:"",date:"",description:"",image:"",is_active:!0}),[S,F]=t.useState(null),[_,C]=t.useState(null),E=async()=>{h(!0);try{const e=await s.getAllForAdmin();u(e||[])}catch(e){e instanceof Error?e.message:String(e)}finally{h(!1)}};t.useEffect((()=>{E()}),[]);const z=e=>{const{name:t,value:s}=e.target;k({...N,[t]:s})};return e.jsx(r,{children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Faaliyetler"}),e.jsxs("button",{onClick:()=>{v(null),k({title:"",date:(new Date).toISOString().split("T")[0],description:"",image:"",is_active:!0}),w(null),y(!0)},className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(l,{className:"-ml-1 mr-2 h-5 w-5"})," Yeni Faaliyet Ekle"]})]}),S&&e.jsx("div",{className:"rounded-md bg-red-50 p-4 mb-6",children:e.jsx("div",{className:"flex",children:e.jsx("div",{className:"ml-3",children:e.jsx("h3",{className:"text-sm font-medium text-red-800",children:S})})})}),_&&e.jsx("div",{className:"rounded-md bg-green-50 p-4 mb-6",children:e.jsx("div",{className:"flex",children:e.jsx("div",{className:"ml-3",children:e.jsx("h3",{className:"text-sm font-medium text-green-800",children:_})})})}),x?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:e.jsx("ul",{className:"divide-y divide-gray-200",children:0===m.length?e.jsx("li",{className:"px-6 py-4 text-center text-gray-500",children:"Henüz hiç faaliyet bulunmuyor"}):m.map((t=>e.jsx("li",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-16 w-16",children:e.jsx("img",{className:"h-16 w-16 rounded object-cover",src:t.image,alt:t.title,onError:e=>{e.target.src="https://via.placeholder.com/150"}})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900",children:t.title}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date(t.date).toLocaleDateString("tr-TR")})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>(async e=>{try{const{error:t}=await a.from("activities").update({is_active:!e.is_active}).eq("id",e.id);if(t)throw t;E()}catch(t){const e=t instanceof Error?t.message:String(t);F(`Görünürlük değiştirilirken hata oluştu: ${e}`)}})(t),className:"text-sm px-2 py-1 rounded-md "+(t.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:t.is_active?e.jsx(n,{className:"h-4 w-4"}):e.jsx(d,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>(e=>{v(e),k({title:e.title,date:e.date.split("T")[0],description:e.description,image:e.image,is_active:e.is_active}),w(null),y(!0)})(t),className:"bg-gray-100 rounded-md p-2 text-black hover:bg-gray-200",children:e.jsx(c,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>(async e=>{if(window.confirm("Bu faaliyeti silmek istediğinizden emin misiniz?")){h(!0),F(null),C(null);try{const{data:s,error:r}=await a.from("activities").select("id, image").eq("id",e).single();if(r)throw new Error(`Kayıt bulunamadı veya erişilemiyor: ${r.message}`);if(!s)throw new Error(`ID: ${e} ile kayıt bulunamadı.`);if(s.image)try{await i.deleteFile(s.image)}catch(t){}const{error:l,data:n}=await a.from("activities").delete().match({id:e});if(l)throw l;const{data:d,error:c}=await a.from("activities").select("id").eq("id",e).single();if(c&&"PGRST116"===c.code)C("Faaliyet başarıyla silindi"),u(m.filter((t=>t.id!==e))),await E();else{if(!c&&d)throw new Error("Silme işlemi gerçekleştirildi ancak kayıt hala veritabanında mevcut.");if(c)throw new Error(`Silme doğrulanamadı: ${c.message}`)}}catch(s){const e=s instanceof Error?s.message:"Bilinmeyen hata";F(`Silme işlemi sırasında hata oluştu: ${e}`)}finally{h(!1)}}})(t.id),className:"bg-red-100 rounded-md p-2 text-red-600 hover:bg-red-200",children:e.jsx(o,{className:"h-4 w-4"})})]})]})},t.id)))})}),b&&e.jsx("div",{className:"fixed inset-0 z-10 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:()=>y(!1)}),e.jsxs("div",{className:"relative bg-white rounded-lg max-w-3xl w-full p-6",children:[e.jsx("div",{className:"mb-4 border-b pb-4",children:e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:p?"Faaliyeti Düzenle":"Yeni Faaliyet Ekle"})}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),F(null),C(null),g(!0);try{if(!N.title||!N.date||!N.description)return F("Lütfen başlık, tarih ve açıklama alanlarını doldurun"),void g(!1);let e=N.image;if(j)try{e=(await i.uploadFile(j,"activities")).url}catch(t){const e=t instanceof Error?t.message:String(t);return F(`Dosya yükleme hatası: ${e}`),void g(!1)}else if(!p&&!N.image)return F("Lütfen bir görsel dosyası seçin"),void g(!1);if(p){const{error:t}=await a.from("activities").update({title:N.title,date:N.date,description:N.description,image:e,is_active:N.is_active}).eq("id",p.id);if(t)throw t;C("Faaliyet başarıyla güncellendi")}else{const{error:t}=await a.from("activities").insert([{title:N.title,date:N.date,description:N.description,image:e,is_active:N.is_active}]);if(t)throw t;C("Faaliyet başarıyla eklendi")}E(),y(!1)}catch(s){const e=s instanceof Error?s.message:String(s);F(`İşlem sırasında hata oluştu: ${e}`)}finally{g(!1)}},children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700",children:"Başlık"}),e.jsx("input",{type:"text",name:"title",id:"title",value:N.title,onChange:z,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"date",className:"block text-sm font-medium text-gray-700",children:"Tarih"}),e.jsx("input",{type:"date",name:"date",id:"date",value:N.date,onChange:z,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Açıklama"}),e.jsx("textarea",{name:"description",id:"description",rows:4,value:N.description,onChange:z,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"imageUpload",className:"block text-sm font-medium text-gray-700",children:"Görsel"}),e.jsxs("div",{className:"mt-1 flex items-center",children:[e.jsx("input",{type:"file",id:"imageUpload",onChange:e=>{e.target.files&&e.target.files.length>0?w(e.target.files[0]):w(null)},accept:"image/*",className:"sr-only"}),e.jsx("label",{htmlFor:"imageUpload",className:"relative cursor-pointer bg-white py-2 px-3 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none",children:e.jsx("span",{children:"Dosya Seç"})}),e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:j?j.name:(null==p?void 0:p.image)?"Mevcut görsel kullanılacak":"Dosya seçilmedi"})]}),(N.image||j)&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Görsel Önizleme:"}),e.jsx("div",{className:"h-40 w-40 relative border rounded overflow-hidden",children:e.jsx("img",{src:j?URL.createObjectURL(j):N.image,alt:"Önizleme",className:"h-full w-full object-cover",onError:e=>{e.target.src="https://via.placeholder.com/150"}})})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"is_active",id:"is_active",checked:N.is_active,onChange:e=>{const{name:t,checked:s}=e.target;k({...N,[t]:s})},className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"is_active",className:"ml-2 block text-sm text-gray-900",children:"Aktif (Görünür)"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>y(!1),className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"İptal"}),e.jsx("button",{type:"submit",disabled:f,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:f?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Yükleniyor..."]}):"Kaydet"})]})]})]})]})})]})})}export{m as default};
